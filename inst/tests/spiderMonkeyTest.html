<html>
  <head>
    <script type="text/javascript" src="../javascript/Rhelpers.js"> </script>
    <script type="text/javascript" src="../javascript/Rscripthandler.js"> </script>
    <script type="text/R">
      library(SpiderMonkey)
      rv = jsVal()
      code = "document;"
      success = JS_EvaluateScript(ScriptCon, 
        JS_GetGlobalObject(ScriptCon)$value,
        code, nchar(code), "script", 1L, rv)$value
      JS_AddRoot(ScriptCon, rv)
      if(!success)
        print("JS_EvaluateScript failed.")

      id = JS_NewStringCopyZ(ScriptCon, "test4")$value
      JS_AddRoot(ScriptCon, id)
      idval = STRING_TO_JSVAL(ScriptCon, id)
      JS_AddRoot(ScriptCon, idval)

      doc = JS_NewObject(ScriptCon, NULL, NULL, NULL)$value
      doc = JS_ValueToObject(ScriptCon, rv, doc)
      #JS_AddRoot(ScriptCon, doc) already AddRooted in ValueToObject

      success = JS_CallFunctionName(ScriptCon, doc, "getElementById", 1L, idval, rv)$value

      if(!success)
        {print("Function call failed")}  
      

      #rv, id, idval, doc
      JS_RemoveRoot(ScriptCon, rv)
      
      JS_RemoveRoot(ScriptCon, id)      
      JS_RemoveRoot(ScriptCon, idval)
      JS_RemoveRoot(ScriptCon, doc)
      TRUE
    </script>
  </head>
  <body name="body" id="body">
    <div id="test1"> </div>
    <div id="test2"> </div>
    <div id="test3"> </div>
    <div id="test4"> </div>
  </body>
</html>
 
