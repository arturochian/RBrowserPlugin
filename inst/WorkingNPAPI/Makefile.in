NPAPI_SDK=@NPAPI_SDK@
R_HOME=@R_HOME@
IS_MAC=@IS_MAC@
PKGCONFIG=pkg-config

CXX=g++
CPPFLAGS += $(shell R CMD config --cppflags ) \
	-I$(NPAPI_SDK)/headers \
	-I$(R_HOME)/include \
	-I./ \
	-fPIC 

ifeq ($(IS_MAC), 1)
  DLIBEXT=dylib
  R_LD_FLAGS=-L$(R_HOME)/lib/$(ARCH) -lR
  TYPE=-dynamiclib
  CPPFLAGS += -DXP_MACOSX -DXP_MAC
else
  DLIBEXT=so
  R_LD_FLAGS=-L$(R_HOME)/lib -lR
  TYPE=-shared
  CPPFLAGS += -DXP_UNIX=1
endif

OBJ_FILES =  WorkingWebR.o WebREngine.o plugin.o
%o: %.cpp
	$(CXX) -c -o $@ $(CPPFLAGS) $<

WebR.$(DLIBEXT): $(OBJ_FILES)
	$(CXX) -Wall -Os $^ $(R_LD_FLAGS) $(TYPE) -o $@

tiny.$(DLIBEXT): tinyplugin.o WebREngine.o plugin.o
	$(CXX) -Wall -Os $^ $(R_LD_FLAGS) $(TYPE) -o $@

default: WebR.$(DLIBEXT) tiny.$(DLIBEXT)

clean: 
	rm *.o
	rm *.so